# 조우 난이도 모델 (클리어 확률 / 재시도)

## 빠른 내비게이션

### 언제 이 문서를 여는가

- 스테이지/보스의 목표 첫 시도 클리어율을 정해야 할 때
- 난이도를 HP/공격력 대신 확률 모델로 관리하고 싶을 때
- 재시도 횟수(p90/p95)와 포기율을 줄이는 튜닝이 필요할 때

### Quick Formula

```
P(clear) = 1 / (1 + exp(-z))
z = β0 + β1*PowerGap + β2*MechanicScore + β3*RetryBonus
PowerGap = ln(PlayerPower / EncounterPower)
P(<=N회 성공) = 1 - (1 - p)^N
```

### 목차

- 1. 왜 클리어 확률로 보나
- 2. 로지스틱 기본 모델
- 3. PowerGap 해석
- 4. 콘텐츠 타입별 목표 클리어율
- 5. 목표 확률에서 요구 파워 역산
- 6. 재시도 확률과 실패 허용량
- 7. RNG가 큰 조우의 보정
- 8. 스테이지 튜닝 실무 절차
- 9. 간단 시뮬레이션 코드
- 10. 텔레메트리 검증 항목
- 설계 체크리스트

## 1. 왜 "클리어 확률"로 보나

HP, 공격력, AI 수치만으로는 난이도를 직접 비교하기 어렵다.
실전에서는 결국 아래가 핵심이다.

- "첫 시도 클리어 확률"
- "N회 안에 클리어할 확률"
- "클리어까지 기대 시도 횟수"

그래서 조우 밸런스는 `확률 모델`로 관리하는 편이 안정적이다.

---

## 2. 로지스틱 기본 모델

가장 실용적인 형태:

```
P(clear) = 1 / (1 + exp(-z))
z = β0 + β1*PowerGap + β2*MechanicScore + β3*RetryBonus
```

### 변수 정의

| 변수 | 의미 | 범위 예시 |
|------|------|-----------|
| PowerGap | 플레이어 전투력과 조우 요구치 차이 | `ln(PlayerPower / EncounterPower)` |
| MechanicScore | 패턴 이해/숙련도 점수 | 0.0 ~ 1.0 |
| RetryBonus | 재시도 보정(학습, 버프, 정보) | 0.0 ~ 1.0 |
| β 계수 | 각 요소의 영향도 | 텔레메트리로 보정 |

예시 계수:

```
β0 = -0.2
β1 = 2.0
β2 = 0.8
β3 = 0.35
```

---

## 3. PowerGap 해석

`PowerGap = ln(PlayerPower / EncounterPower)` 를 쓰면 비율 해석이 쉽다.

| 플레이어/조우 파워 비율 | PowerGap |
|-------------------------|----------|
| 0.74x | -0.3 |
| 0.86x | -0.15 |
| 1.00x | 0 |
| 1.16x | +0.15 |
| 1.35x | +0.3 |

계수 예시(`MechanicScore=0.5`, `RetryBonus=0`)에서의 첫 시도 클리어 확률:

| PowerGap | P(clear) |
|----------|----------|
| -0.30 | 40.1% |
| -0.15 | 47.5% |
| 0.00 | 55.0% |
| +0.15 | 62.2% |
| +0.30 | 69.0% |

---

## 4. 콘텐츠 타입별 목표 클리어율 (휴리스틱)

| 콘텐츠 | 첫 시도 목표 클리어율 | 의도 |
|--------|------------------------|------|
| 튜토리얼/온보딩 | 85~95% | 이탈 방지, 기본 조작 학습 |
| 메인 캠페인 일반 | 60~75% | 긴장감 + 진행성 |
| 메인 캠페인 보스 | 45~60% | 패턴 학습 유도 |
| 하드 모드 | 35~50% | 빌드 점검, 재도전 가치 |
| 챌린지/엔드게임 | 20~40% | 장기 숙련 목표 |

주의:

- 같은 평균이라도 분산이 크면 "운빨 콘텐츠"로 인식된다.
- 하드 콘텐츠는 첫 시도 확률을 낮추되, 재시도 학습 보상을 제공해야 한다.

---

## 5. 목표 확률에서 요구 파워 역산

로지스틱의 역함수(logit):

```
logit(p) = ln(p / (1-p))
PowerGap_target = (logit(p) - β0 - β2*MechanicScore - β3*RetryBonus) / β1
```

예시 (`MechanicScore=0.5`, `RetryBonus=0`):

| 목표 첫 시도 확률 | 필요한 PowerGap |
|------------------|-----------------|
| 55% | 0.000 |
| 65% | +0.210 |
| 75% | +0.449 |

의미:

- 75%를 원하면 파워 우위가 매우 커야 하므로, 전투가 너무 쉬워질 수 있다.
- 보스/하드 콘텐츠는 파워 우위 대신 `학습 보상`으로 확률을 올리는 편이 낫다.

---

## 6. 재시도 확률과 실패 허용량

반복 시도에서 "N회 내 성공 확률"은:

```
P(<=N회 성공) = 1 - (1 - p)^N
```

기대 시도 횟수(단순 모델):

```
E[시도] = 1 / p
E[실패] = (1-p) / p
```

예시:

| 첫 시도 p | 기대 시도 횟수 | 90% 성공까지 필요 시도 | 95% 성공까지 필요 시도 |
|-----------|----------------|-------------------------|-------------------------|
| 0.35 | 2.86회 | 6회 | 7회 |
| 0.45 | 2.22회 | 4회 | 6회 |
| 0.55 | 1.82회 | 3회 | 4회 |
| 0.65 | 1.54회 | 3회 | 3회 |
| 0.75 | 1.33회 | 2회 | 3회 |

운영 기준 예시:

- 메인 진행 보스는 90% 성공까지 `3~5회` 안에 들어오게 설계
- 챌린지는 `5~8회`도 허용하되 보상/학습 장치가 있어야 함

---

## 7. RNG가 큰 조우의 보정

확률 모델과 별개로 RNG 분산을 줄여야 공정하게 느껴진다.

대표 원인:

- 치명타/회피 등 Output RNG 비중 과다
- 핵심 기믹이 단일 랜덤 이벤트에 과의존
- 패턴 간 안전 딜 타임 편차가 큼

보정 레버:

1. 핵심 실패 시 회복 가능성 제공(부활, 리소스 환급)
2. 연속 불운 완충(최저 피해 보장, 약한 pity)
3. 랜덤 기믹을 "예고 + 대응 가능" 형태로 변환

---

## 8. 스테이지 튜닝 실무 절차

1. 목표 첫 시도 클리어율 정의
2. 현재 텔레메트리로 `PowerGap` 분포 추정
3. 로지스틱 계수(β) 임시값 설정
4. 목표 확률에 맞게 적 HP/공격력/패턴 밀도 역산
5. 시뮬레이션으로 p50/p90 재시도 횟수 확인
6. 플레이테스트로 숙련도 효과(`MechanicScore`) 보정

---

## 9. 간단 시뮬레이션 코드

```python
import math
import random


def clear_prob(power_gap, mechanic=0.5, retry_bonus=0.0):
    b0, b1, b2, b3 = -0.2, 2.0, 0.8, 0.35
    z = b0 + b1 * power_gap + b2 * mechanic + b3 * retry_bonus
    return 1.0 / (1.0 + math.exp(-z))


def simulate_until_clear(power_gap, max_attempt=10):
    for n in range(1, max_attempt + 1):
        retry_bonus = min((n - 1) * 0.15, 0.6)
        p = clear_prob(power_gap, mechanic=0.5, retry_bonus=retry_bonus)
        if random.random() < p:
            return n
    return max_attempt
```

---

## 10. 텔레메트리 검증 항목

필수 수집:

1. 스테이지별 첫 시도 클리어율
2. 클리어까지 시도 횟수 분포(p50/p90/p95)
3. 시도 중 포기율(도중 이탈)
4. 코호트별(신규/복귀/고숙련) 클리어율 차이
5. 파워 갭 구간별 클리어율 곡선

경보 예시:

- 목표 대비 첫 시도 클리어율이 `-15%p` 이상 이탈
- p90 시도 횟수가 설계 목표의 `+2회` 이상
- 특정 구간에서 포기율 급증(학습 동선 문제 가능)

---

## 설계 체크리스트

1. [ ] 콘텐츠 타입별 목표 첫 시도 클리어율이 정의되어 있는가?
2. [ ] PowerGap 정의가 팀 내에서 통일되어 있는가?
3. [ ] 목표 확률에서 역산한 스탯/패턴 조정값이 있는가?
4. [ ] N회 내 성공 확률(90%, 95%)을 함께 검증했는가?
5. [ ] RNG 분산 완화 장치를 최소 1개 이상 넣었는가?
6. [ ] 텔레메트리로 β 계수를 주기적으로 재보정하는가?

---

## 다음으로 볼 문서

- `./combat-ttk-ehp.md` (클리어 확률 목표를 TTK/EHP 파라미터로 변환)
- `./curve-genre-tempo.md` (장르 템포에 맞는 목표 클리어율 밴드 선택)
- `./economy-faucet-sink.md` (클리어율 변화에 따른 보상 유입량 점검)
